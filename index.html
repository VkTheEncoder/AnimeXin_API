<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DongFlix Streaming - Watch Donghua Online</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6a00f4;
            --primary-dark: #4a00b0;
            --secondary: #ff4081;
            --dark: #121212;
            --dark-light: #1e1e1e;
            --light: #f5f5f5;
            --gray: #757575;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --header-bg: rgba(18, 18, 18, 0.95);
        }
        
        [data-theme="light"] {
            --primary: #6a00f4;
            --primary-dark: #4a00b0;
            --secondary: #ff4081;
            --dark: #f5f5f5;
            --dark-light: #e0e0e0;
            --light: #121212;
            --gray: #757575;
            --text-primary: #121212;
            --text-secondary: #424242;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --header-bg: rgba(245, 245, 245, 0.95);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: 14px;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles */
        header {
            background: var(--header-bg);
            padding: 12px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        header.scrolled {
            padding: 8px 0;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo img {
            height: 32px;
        }
        
        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            width: 50%;
            position: relative;
            flex-grow: 1;
        }
        
        .search-bar input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 20px;
            border: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 12px;
            transition: all 0.3s ease;
            padding-right: 35px;
        }
        
        .search-bar input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 2px var(--primary);
        }
        
        .search-bar button {
            position: absolute;
            right: 8px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
        }
        
        .user-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .user-actions a {
            color: var(--text-primary);
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .user-actions a i {
            font-size: 14px;
        }
        
        .user-actions a:hover {
            color: var(--secondary);
        }
        
        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .theme-toggle:hover {
            transform: rotate(30deg);
        }
        
        /* Hero Section */
        .hero {
            height: 300px;
            margin-top: 60px;
            position: relative;
            overflow: hidden;
            border-radius: 0 0 15px 15px;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(18, 18, 18, 0.9), rgba(18, 18, 18, 0.5));
            z-index: 1;
        }
        
        .hero-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            transition: opacity 0.5s ease;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
            height: 100%;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }
        
        .hero-info {
            max-width: 500px;
        }
        
        .hero-info h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: fadeInUp 1s ease;
        }
        
        .hero-info p {
            font-size: 12px;
            line-height: 1.5;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.8);
            animation: fadeInUp 1s ease 0.2s forwards;
            opacity: 0;
        }
        
        .hero-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            animation: fadeInUp 1s ease 0.4s forwards;
            opacity: 0;
        }
        
        .meta-item {
            background-color: rgba(106, 0, 244, 0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 500;
            border: 1px solid var(--primary);
        }
        
        .hero-actions {
            display: flex;
            gap: 10px;
            animation: fadeInUp 1s ease 0.6s forwards;
            opacity: 0;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(106, 0, 244, 0.3);
        }
        
        .btn-secondary {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--primary);
        }
        
        .btn-secondary:hover {
            background-color: rgba(106, 0, 244, 0.2);
            transform: translateY(-3px);
        }
        
        /* Main Content */
        main {
            padding: 30px 0;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            color: var(--primary);
            font-size: 16px;
        }
        
        /* Search Results */
        .search-results {
            display: none;
            margin-top: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .result-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .result-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .result-info {
            padding: 10px;
        }
        
        .result-info h3 {
            font-size: 13px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text-primary);
        }
        
        .result-info p {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .hot-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: var(--secondary);
            color: white;
            padding: 2px 6px;
            border-radius: 15px;
            font-size: 9px;
            font-weight: 600;
        }
        
        /* Donghua Info */
        .donghua-info {
            display: none;
            margin-top: 20px;
        }
        
        .donghua-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-direction: column;
        }
        
        .donghua-poster {
            flex: 0 0 250px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            margin: 0 auto;
            max-width: 100%;
        }
        
        .donghua-poster img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .donghua-details {
            flex: 1;
        }
        
        .donghua-title {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .donghua-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 400;
        }
        
        .donghua-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .donghua-meta-item {
            background-color: rgba(106, 0, 244, 0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            border: 1px solid var(--primary);
            color: var(--text-primary);
        }
        
        .donghua-synopsis {
            margin-bottom: 15px;
            line-height: 1.5;
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .info-item {
            background-color: var(--card-bg);
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .info-item h4 {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .info-item p {
            font-size: 12px;
            color: var(--text-primary);
        }
        
        /* Episodes Section */
        .episodes-section {
            margin-top: 30px;
        }
        
        .episodes-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }
        
        .episode-card {
            background-color: var(--card-bg);
            border-radius: 6px;
            padding: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .episode-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(106, 0, 244, 0.2);
        }
        
        .episode-card::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .episode-card:hover::before {
            transform: scaleX(1);
        }
        
        .episode-card.active {
            background-color: var(--primary);
            box-shadow: 0 5px 15px rgba(106, 0, 244, 0.3);
            color: white;
        }
        
        .episode-card.active .episode-date {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .episode-card.playing {
            animation: pulseBorder 2s infinite;
        }
        
        .episode-number {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .episode-date {
            font-size: 10px;
            color: var(--text-secondary);
        }
        
        .episode-subtype {
            font-size: 9px;
            background-color: var(--primary);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            margin-top: 5px;
            display: inline-block;
        }
        
        /* Video Player Section */
        .video-section {
            display: none;
            margin-top: 20px;
            position: relative;
        }
        
        .video-container {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            background-color: black;
            aspect-ratio: 16/9;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .server-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .server-btn {
            padding: 6px 12px;
            border-radius: 15px;
            background-color: var(--card-bg);
            border: none;
            color: var(--text-primary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .server-btn:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .server-btn.active {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        .server-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .server-btn:hover::after {
            transform: scaleX(1);
        }
        
        .server-btn.active::after {
            transform: scaleX(1);
            background-color: white;
        }
        
        .now-playing {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding: 8px;
            background-color: rgba(106, 0, 244, 0.1);
            border-radius: 6px;
            border-left: 3px solid var(--primary);
            font-size: 13px;
        }
        
        .now-playing i {
            color: var(--primary);
            font-size: 14px;
        }
        
        /* Episode Navigation */
        .episode-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .episode-nav-btn {
            padding: 8px 15px;
            border-radius: 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .episode-nav-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .episode-nav-btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }
        
        /* Lights Off Mode */
        body.lights-off {
            background-color: #000;
        }
        
        body.lights-off .container > *:not(.video-section) {
            filter: blur(5px);
            opacity: 0.3;
            pointer-events: none;
            user-select: none;
        }
        
        body.lights-off .video-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1001;
            background: #000;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        body.lights-off .video-container {
            flex-grow: 1;
            margin-bottom: 10px;
        }
        
        body.lights-off .server-selector,
        body.lights-off .now-playing {
            display: none;
        }
        
        .lights-off-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .lights-off-btn:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        /* Footer */
        footer {
            background-color: var(--dark-light);
            padding: 30px 0;
            margin-top: 40px;
        }
        
        .footer-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .footer-col h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .footer-col ul {
            list-style: none;
        }
        
        .footer-col ul li {
            margin-bottom: 8px;
        }
        
        .footer-col ul li a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s ease;
            font-size: 12px;
        }
        
        .footer-col ul li a:hover {
            color: var(--primary);
        }
        
        .social-links {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .social-links a {
            color: var(--text-primary);
            background-color: var(--dark);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .social-links a:hover {
            background-color: var(--primary);
            transform: translateY(-3px);
        }
        
        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            font-size: 12px;
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes pulseBorder {
            0% {
                box-shadow: 0 0 0 0 rgba(106, 0, 244, 0.7);
            }
            70% {
                box-shadow: 0 0 0 8px rgba(106, 0, 244, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(106, 0, 244, 0);
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Loading Spinner */
        .loader {
            display: none;
            margin: 30px auto;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Styles */
        @media (min-width: 768px) {
            .hero {
                height: 350px;
            }
            
            .hero-info h1 {
                font-size: 28px;
            }
            
            .hero-info p {
                font-size: 14px;
            }
            
            .donghua-container {
                flex-direction: row;
            }
            
            .donghua-poster {
                margin: 0;
            }
            
            .donghua-title {
                font-size: 24px;
            }
        }
        
        @media (min-width: 992px) {
            .hero {
                height: 400px;
            }
            
            .hero-info h1 {
                font-size: 32px;
            }
            
            .donghua-title {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header id="header">
        <div class="container header-container">
            <div class="logo">
                <img src="https://i.imgur.com/JQH5ZxN.png" alt="DongFlix Logo">
                <h1>DongFlix</h1>
            </div>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search for donghua...">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>
            <div class="user-actions">
                <button id="theme-toggle" class="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="#"><i class="fas fa-home"></i> Home</a>
                <a href="#"><i class="fas fa-bookmark"></i> Bookmarks</a>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <img src="https://animexin.dev/wp-content/uploads/2025/01/Wu-Dong-Qian-Kun-Season-5.png" alt="Hero Background" class="hero-bg">
        <div class="hero-content">
            <div class="hero-info">
                <h1>Watch Donghua Online</h1>
                <p>Stream your favorite Chinese animations in high quality with multiple subtitle options. Discover new series and never miss an episode.</p>
                <div class="hero-meta">
                    <span class="meta-item">HD Quality</span>
                    <span class="meta-item">Multiple Subs</span>
                    <span class="meta-item">No Ads</span>
                </div>
                <div class="hero-actions">
                    <button class="btn btn-primary pulse" id="browse-btn"><i class="fas fa-play"></i> Browse Donghua</button>
                    <button class="btn btn-secondary"><i class="fas fa-info-circle"></i> Learn More</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container">
        <!-- Search Results -->
        <div id="search-results" class="search-results">
            <h2 class="section-title"><i class="fas fa-search"></i> Search Results</h2>
            <div id="results-grid" class="results-grid">
                <!-- Results will be populated here by JavaScript -->
            </div>
        </div>

        <!-- Donghua Info -->
        <div id="donghua-info" class="donghua-info">
            <div id="donghua-container" class="donghua-container">
                <!-- Donghua info will be populated here by JavaScript -->
            </div>
            
            <!-- Video Player -->
            <div id="video-section" class="video-section">
                <button id="lights-off-btn" class="lights-off-btn" title="Lights Off">
                    <i class="fas fa-lightbulb"></i>
                </button>
                <div id="now-playing" class="now-playing">
                    <i class="fas fa-play-circle"></i>
                    <span id="current-episode-title">Select an episode to play</span>
                </div>
                <div class="video-container">
                    <iframe id="video-player" allowfullscreen></iframe>
                </div>
                <div class="server-selector" id="server-selector">
                    <!-- Server buttons will be populated here by JavaScript -->
                </div>
                <div class="episode-navigation" id="episode-navigation">
                    <button id="prev-episode" class="episode-nav-btn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button id="next-episode" class="episode-nav-btn" disabled>
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <div class="episodes-section">
                <h2 class="section-title"><i class="fas fa-list-ol"></i> Episodes</h2>
                <div id="episodes-list" class="episodes-list">
                    <!-- Episodes will be populated here by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loader" class="loader"></div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container footer-container">
            <div class="footer-col">
                <h3>DongFlix</h3>
                <p>Your premier destination for streaming Chinese animations with multiple subtitle options and high-quality video.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-telegram"></i></a>
                    <a href="#"><i class="fab fa-discord"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-github"></i></a>
                </div>
            </div>
            <div class="footer-col">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Popular Donghua</a></li>
                    <li><a href="#">New Releases</a></li>
                    <li><a href="#">Request Series</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Categories</h3>
                <ul>
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Adventure</a></li>
                    <li><a href="#">Fantasy</a></li>
                    <li><a href="#">Martial Arts</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Help</h3>
                <ul>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">DMCA</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            &copy; 2025 DongFlix. All Rights Reserved. This content is provided and hosted by third parties.
        </div>
    </footer>

    <script>
        // API Base URL
        const API_BASE = "https://few-charlotte-3ad0w-2970694f.koyeb.app/";
        
        // DOM Elements
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const browseBtn = document.getElementById('browse-btn');
        const searchResults = document.getElementById('search-results');
        const resultsGrid = document.getElementById('results-grid');
        const donghuaInfo = document.getElementById('donghua-info');
        const donghuaContainer = document.getElementById('donghua-container');
        const episodesList = document.getElementById('episodes-list');
        const videoSection = document.getElementById('video-section');
        const videoPlayer = document.getElementById('video-player');
        const serverSelector = document.getElementById('server-selector');
        const loader = document.getElementById('loader');
        const header = document.getElementById('header');
        const nowPlaying = document.getElementById('now-playing');
        const currentEpisodeTitle = document.getElementById('current-episode-title');
        const themeToggle = document.getElementById('theme-toggle');
        const lightsOffBtn = document.getElementById('lights-off-btn');
        const prevEpisodeBtn = document.getElementById('prev-episode');
        const nextEpisodeBtn = document.getElementById('next-episode');
        const episodeNav = document.getElementById('episode-navigation');
        
        // Current state
        let currentDonghua = null;
        let currentEpisode = null;
        let currentEpisodeData = null;
        let currentEpisodeIndex = -1;
        let sortedEpisodes = [];
        let isLightsOff = false;
        let isDarkMode = false;
        
        // Event Listeners
        searchBtn.addEventListener('click', performSearch);
        browseBtn.addEventListener('click', () => {
            searchInput.value = '';
            searchResults.style.display = 'none';
            donghuaInfo.style.display = 'none';
            videoSection.style.display = 'none';
        });
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') performSearch();
        });
        themeToggle.addEventListener('click', toggleTheme);
        lightsOffBtn.addEventListener('click', toggleLightsOff);
        prevEpisodeBtn.addEventListener('click', playPreviousEpisode);
        nextEpisodeBtn.addEventListener('click', playNextEpisode);
        
        // Check for saved theme preference
        if (localStorage.getItem('theme') === 'light') {
            toggleTheme();
        }
        
        // Header scroll effect
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // Functions
        function showLoader() {
            loader.style.display = 'block';
        }
        
        function hideLoader() {
            loader.style.display = 'none';
        }
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.setAttribute('data-theme', isDarkMode ? 'light' : 'dark');
            themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            localStorage.setItem('theme', isDarkMode ? 'light' : 'dark');
        }
        
        function toggleLightsOff() {
            isLightsOff = !isLightsOff;
            document.body.classList.toggle('lights-off', isLightsOff);
            lightsOffBtn.innerHTML = isLightsOff ? '<i class="fas fa-lightbulb"></i>' : '<i class="fas fa-lightbulb"></i>';
            lightsOffBtn.title = isLightsOff ? 'Lights On' : 'Lights Off';
            
            if (isLightsOff) {
                // Scroll to video player
                videoSection.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        function performSearch() {
            const query = searchInput.value.trim();
            if (!query) return;
            
            showLoader();
            searchResults.style.display = 'block';
            donghuaInfo.style.display = 'none';
            videoSection.style.display = 'none';
            
            fetch(`${API_BASE}search?query=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.results && data.results.length > 0) {
                        displaySearchResults(data.results);
                    } else {
                        resultsGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No results found. Try a different search term.</p>';
                    }
                    hideLoader();
                })
                .catch(error => {
                    console.error('Error searching:', error);
                    hideLoader();
                    resultsGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">Error loading results. Please try again.</p>';
                });
        }
        
        function displaySearchResults(results) {
            resultsGrid.innerHTML = '';
            
            if (results.length === 0) {
                resultsGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No results found. Try a different search term.</p>';
                return;
            }
            
            results.forEach(donghua => {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    ${donghua.is_hot ? '<span class="hot-badge">HOT</span>' : ''}
                    <img src="${donghua.image}" alt="${donghua.title}" onerror="this.src='https://via.placeholder.com/300x450'">
                    <div class="result-info">
                        <h3>${donghua.title}</h3>
                        <p>${donghua.type || 'Donghua'} • ${donghua.status || 'Status N/A'}</p>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    showDonghuaInfo(donghua.slug);
                });
                
                resultsGrid.appendChild(card);
            });
        }
        
        function showDonghuaInfo(slug) {
            showLoader();
            searchResults.style.display = 'none';
            donghuaInfo.style.display = 'block';
            videoSection.style.display = 'none';
            
            fetch(`${API_BASE}donghua/info?slug=${slug}`)
                .then(response => response.json())
                .then(data => {
                    currentDonghua = data;
                    displayDonghuaInfo(data);
                    hideLoader();
                })
                .catch(error => {
                    console.error('Error fetching donghua info:', error);
                    hideLoader();
                    donghuaContainer.innerHTML = '<p>Error loading donghua information. Please try again.</p>';
                });
        }
        
        function displayDonghuaInfo(data) {
            // Use cover image as background and thumb as poster
            const coverImage = data.cover_images?.main || 
                              'https://via.placeholder.com/1200x675';
            const posterImage = data.cover_images?.thumb || 
                              data.cover_images?.main || 
                              'https://via.placeholder.com/300x450';
            
            // Main info section
            donghuaContainer.innerHTML = `
                <div class="donghua-poster">
                    <img src="${posterImage}" alt="${data.title}" onerror="this.src='https://via.placeholder.com/300x450'">
                </div>
                <div class="donghua-details">
                    <h1 class="donghua-title">${data.title}</h1>
                    ${data.alternate_title ? `<h2 class="donghua-subtitle">${data.alternate_title}</h2>` : ''}
                    <div class="donghua-meta">
                        ${data.genres ? data.genres.map(genre => `<span class="donghua-meta-item">${genre}</span>`).join('') : ''}
                        <span class="donghua-meta-item">${data.info?.Type || 'ONA'}</span>
                        <span class="donghua-meta-item">${data.info?.Status || 'Status N/A'}</span>
                        ${data.rating ? `<span class="donghua-meta-item"><i class="fas fa-star"></i> ${data.rating.value || 'N/A'}</span>` : ''}
                    </div>
                    <p class="donghua-synopsis">${data.synopsis?.english || data.description || 'No synopsis available.'}</p>
                    
                    <div class="info-grid">
                        ${data.info ? Object.entries(data.info).map(([key, value]) => `
                            <div class="info-item">
                                <h4>${key}</h4>
                                <p>${value || 'N/A'}</p>
                            </div>
                        `).join('') : ''}
                    </div>
                </div>
            `;
            
            // Update hero background with cover image if available
            const heroBg = document.querySelector('.hero-bg');
            if (heroBg && coverImage) {
                heroBg.src = coverImage;
            }
            
            // Episodes list
            episodesList.innerHTML = '';
            if (data.episodes && data.episodes.length > 0) {
                // Sort episodes in descending order (newest first)
                sortedEpisodes = [...data.episodes].sort((a, b) => {
                    return parseInt(b.episode_number) - parseInt(a.episode_number);
                });

                sortedEpisodes.forEach((episode, index) => {
                    const epCard = document.createElement('div');
                    epCard.className = 'episode-card';
                    epCard.dataset.index = index;
                    epCard.innerHTML = `
                        <div class="episode-number">${episode.episode_number || 'Episode'}</div>
                        <div class="episode-date">${episode.release_date || ''}</div>
                        ${episode.sub_type ? `<div class="episode-subtype">${episode.sub_type}</div>` : ''}
                    `;
                    
                    epCard.addEventListener('click', () => {
                        document.querySelectorAll('.episode-card').forEach(card => {
                            card.classList.remove('active', 'playing');
                        });
                        
                        epCard.classList.add('active', 'playing');
                        currentEpisodeTitle.textContent = episode.title || `Episode ${episode.episode_number}`;
                        currentEpisodeIndex = index;
                        updateEpisodeNavButtons();
                        showEpisode(episode.ep_slug, episode);
                    });
                    
                    episodesList.appendChild(epCard);
                });
                
                // Activate first episode by default
                if (sortedEpisodes.length > 0) {
                    const firstEpisodeCard = document.querySelector('.episode-card');
                    firstEpisodeCard.classList.add('active');
                    currentEpisodeTitle.textContent = sortedEpisodes[0].title || `Episode ${sortedEpisodes[0].episode_number}`;
                    currentEpisodeIndex = 0;
                    updateEpisodeNavButtons();
                    showEpisode(sortedEpisodes[0].ep_slug, sortedEpisodes[0]);
                }
            } else {
                episodesList.innerHTML = '<p>No episodes available for this donghua.</p>';
                episodeNav.style.display = 'none';
            }
        }
        
        function showEpisode(ep_slug, episodeData) {
            showLoader();
            videoSection.style.display = 'block';
            currentEpisode = ep_slug;
            currentEpisodeData = episodeData;
            
            fetch(`${API_BASE}episode/videos?ep_slug=${ep_slug}`)
                .then(response => response.json())
                .then(data => {
                    displayVideoServers(data.video_servers);
                    hideLoader();
                })
                .catch(error => {
                    console.error('Error fetching episode:', error);
                    hideLoader();
                    serverSelector.innerHTML = '<p>Error loading video servers. Please try again.</p>';
                });
        }
        
        function displayVideoServers(servers) {
            serverSelector.innerHTML = '';
            
            if (!servers || servers.length === 0) {
                serverSelector.innerHTML = '<p>No video servers available for this episode.</p>';
                videoPlayer.src = '';
                return;
            }
            
            // Create server buttons
            servers.forEach((server, index) => {
                const btn = document.createElement('button');
                btn.className = 'server-btn';
                if (index === 0) btn.classList.add('active');
                btn.textContent = server.server_name;
                btn.title = server.server_name; // Add tooltip
                
                btn.addEventListener('click', () => {
                    // Remove active class from all buttons
                    document.querySelectorAll('.server-btn').forEach(button => {
                        button.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    btn.classList.add('active');
                    
                    // Load video
                    loadVideo(server.video_url);
                });
                
                serverSelector.appendChild(btn);
            });
            
            // Load first video by default
            if (servers.length > 0) {
                loadVideo(servers[0].video_url);
            }
        }
        
        function loadVideo(url) {
            // Handle different video hosting providers
            if (url.includes('dailymotion.com')) {
                videoPlayer.src = url;
            } else if (url.includes('ok.ru')) {
                videoPlayer.src = url;
            } else if (url.includes('mega.nz')) {
                // Mega.nz doesn't support direct embedding, show a link instead
                videoPlayer.src = '';
                serverSelector.innerHTML += `
                    <div style="grid-column: 1/-1; text-align: center; padding: 10px; background: var(--card-bg); border-radius: 8px;">
                        <p>Mega.nz videos cannot be embedded.</p>
                        <a href="${url.replace('/embed/', '/file/')}" target="_blank" class="btn btn-primary" style="margin-top: 10px;">
                            <i class="fas fa-external-link-alt"></i> Watch on Mega
                        </a>
                    </div>
                `;
            } else if (url.includes('rumble.com')) {
                videoPlayer.src = url;
            } else if (url.includes('dooodster.com')) {
                // Doodstream requires special handling
                videoPlayer.src = `https://dood.to/e/${url.split('/').pop()}`;
            } else {
                videoPlayer.src = url;
            }
        }
        
        function playPreviousEpisode() {
            if (currentEpisodeIndex < sortedEpisodes.length - 1) {
                const prevEpisode = sortedEpisodes[currentEpisodeIndex + 1];
                const prevEpisodeCard = document.querySelector(`.episode-card[data-index="${currentEpisodeIndex + 1}"]`);
                
                if (prevEpisode && prevEpisodeCard) {
                    document.querySelectorAll('.episode-card').forEach(card => {
                        card.classList.remove('active', 'playing');
                    });
                    
                    prevEpisodeCard.classList.add('active', 'playing');
                    currentEpisodeTitle.textContent = prevEpisode.title || `Episode ${prevEpisode.episode_number}`;
                    currentEpisodeIndex = currentEpisodeIndex + 1;
                    updateEpisodeNavButtons();
                    showEpisode(prevEpisode.ep_slug, prevEpisode);
                    
                    // Scroll to the episode card
                    prevEpisodeCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }
        
        function playNextEpisode() {
            if (currentEpisodeIndex > 0) {
                const nextEpisode = sortedEpisodes[currentEpisodeIndex - 1];
                const nextEpisodeCard = document.querySelector(`.episode-card[data-index="${currentEpisodeIndex - 1}"]`);
                
                if (nextEpisode && nextEpisodeCard) {
                    document.querySelectorAll('.episode-card').forEach(card => {
                        card.classList.remove('active', 'playing');
                    });
                    
                    nextEpisodeCard.classList.add('active', 'playing');
                    currentEpisodeTitle.textContent = nextEpisode.title || `Episode ${nextEpisode.episode_number}`;
                    currentEpisodeIndex = currentEpisodeIndex - 1;
                    updateEpisodeNavButtons();
                    showEpisode(nextEpisode.ep_slug, nextEpisode);
                    
                    // Scroll to the episode card
                    nextEpisodeCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }
        
        function updateEpisodeNavButtons() {
            prevEpisodeBtn.disabled = currentEpisodeIndex >= sortedEpisodes.length - 1;
            nextEpisodeBtn.disabled = currentEpisodeIndex <= 0;
        }
        
        // Initialize with empty state
        window.addEventListener('load', () => {
            searchResults.style.display = 'none';
            donghuaInfo.style.display = 'none';
            videoSection.style.display = 'none';
        });
    </script>
</body>
</html>
